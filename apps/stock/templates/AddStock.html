{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Add Stocks{% endblock %}

{% load crispy_forms_tags %}

{% block content %}

<div class="container mt-4">
  <h1 class="text-center">Add Stock</h1>

  <!-- Stock Form -->
  <form method="post">
    {% csrf_token %}

    {{ form|crispy }} <!-- Render Django form fields dynamically -->

    <div class="d-flex justify-content-end mt-3">
      <button type="submit" class="btn btn-info" name="add_to_list" value="true">Add to List</button>
    </div>
  </form>

  <!-- Temporary Stock List -->
  <div class="card mt-5">
    <h5 class="card-header">New Stock List</h5>
    <div class="table-responsive text-nowrap">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Product Code</th>
            <th>Generic Name</th>
            <th>Quantity</th>
            <th>Branch</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% if temp_stock %}
            {% for item in temp_stock %}
              <tr>
                <td>{{ item.product_code }}</td>
                <td>{{ item.product_name }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.branch_name }}</td>
                <td>
                  <form method="post" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="product_code" value="{{ item.product_code }}" />
                    <input type="hidden" name="branch" value="{{ item.branch_id }}" />
                    <button type="submit" class="btn btn-danger btn-sm" name="remove_item" value="true">Remove</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="4" class="text-center">No items in the list.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Submit Stock Update -->
  <div class="d-flex justify-content-center mt-4">
    <form method="post">
      {% csrf_token %}
      <button type="submit" class="btn btn-primary btn-lg" name="update_stock" value="true">
        Add Stock
      </button>
    </form>
  </div>
</div>

{% endblock %}


{% block page_js %}

<script>
  $(document).ready(function () {
    // Initialize Select2 on the product field
    $("#id_product").select2({
      placeholder: "Search for a product",
      allowClear: true,
      width: "100%",
    });
  });
</script>


{% endblock %}